<?xml version="1.0" encoding="utf-8"?>
<html>
<head>
  <title>QEEG Interpreter</title>
  
  <style>
    
    body {
      margin: 100px;
      font-family: monospace;
      background-color: paleturquoise;
    }

    hr {
      border-style: solid;
      border-width: 0.5px;
      border-top-width: 0;
    }
    
  </style>
  
  <!-- importing the automatically build module -->
  <script src="../dist/qeegmodfile.js"></script>
</head>
<body>
  
  <p>
    Select a QEEG MOD file:
    <input type="file" id="fileInput" accept=".mod,.MOD">
  </p>
  
  <hr>
  
  <div id="output"></div>

  <script>
    var fileInput = document.getElementById('fileInput');
    var interpreter = null;
    
    fileInput.addEventListener('change', function(e) {
      var files = e.target.files;
      
      if( !files.length )
        return;
        
      var reader = new FileReader();
      
      reader.onloadend = function(event) {
        var result = event.target.result;
        parseEegFile( result );
      }
      
      reader.onerror = function() {}
      
      reader.readAsArrayBuffer( files[0] );
		});
    
    
    function parseEegFile( arrayBuffer ){
      clearOutput();
      
      // create an instance with no argument
      var myEegParser = new qeegmodfile.QeegModFileParser();
      myEegParser.setRawData( arrayBuffer );
      
      // qeegData contains metadata and raw data that are still hard to read 
      var qeegData = myEegParser.parse();
      console.log( qeegData );
      
      if( !qeegData ){
        printOutput("CORRUPTED FILE!")
        console.warn("The file is corrupted.");
        return;
      }
      
      
      
      //instanciate an interpreter
      interpreter = new qeegmodfile.QeegModFileInterpreter( qeegData );
      
      var type = interpreter.getType();
      var typeCode = interpreter.getTypeCode();
      var numberOfDimensionsUsed = interpreter.getNumberOfDimensionsUsed();
      var dimensionSizes = interpreter.getDimensionSizes();
      var dimensionsLabels = interpreter.getAllDimensionsLabel();
      var startFrequency = interpreter.getStartFrequency();
      var frequencyResolution = interpreter.getFrequencyResolution();
      var scaleFactor = interpreter.getScaleFactor();
      
      printOutput( "<b>Type of study:</b> " + type );
      printOutput( "<b>Type code of study:</b> " + typeCode );
      printOutput( "<b>Number of dimensions actually used:</b> " + numberOfDimensionsUsed );
      printOutput( "<b>Dimensions' sizes:</b> " + dimensionSizes.join(", ") );
      printOutput( "<b>Used dimension's name:</b> " + makeList( dimensionsLabels.slice(0, numberOfDimensionsUsed)) );
      printOutput( "<b>Start frequency:</b> " + startFrequency );
      printOutput( "<b>Scale factor:</b> " + scaleFactor );

      
      //console.log( interpreter.getValue( 0, 1, 0, 0 ) );
      
      //console.log( interpreter.getSpectrum(0, 0));
      //console.log( interpreter.getSpectrumLabels(0, 0));
      
      //console.log( interpreter.getType() );
      
      
      //console.log( interpreter.getSpectrumByLabels( "Absolute Power", "Theta" ) );
      //console.log( interpreter.getSpectrumLabelsByLabels( "Absolute Power", "Theta" ) );
      
      
    }
    
    
    // add an output to the log place
    function printOutput( str ){
      var output = document.getElementById( "output" );
      output.innerHTML += "<p>" + str + "</p>";
    }
    
    // clear the output zone
    function clearOutput(){
      var output = document.getElementById( "output" );
      output.innerHTML = "";
    }
    
    // make a ul li list from an array of string 
    function makeList( arr ){
      if( !arr || !arr.length )
        return "";
        
      return "<ul><li>" + arr.join("</li><li>") + "</li></ul>";
    }
    

  </script>

</body>
</html>
